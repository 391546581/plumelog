{
  "filename": "update.md",
  "__html": "<h2 id=\"%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%97%A5%E5%8E%86\">版本升级日历 <a class=\"header-anchor\" href=\"#%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%97%A5%E5%8E%86\">#</a></h2>\n<h3 id=\"3.3%E7%89%88%E6%9C%AC\">3.3版本 <a class=\"header-anchor\" href=\"#3.3%E7%89%88%E6%9C%AC\">#</a></h3>\n<h4 id=\"%E5%8D%87%E7%BA%A7%E5%88%B03.3%E7%89%88%E6%9C%AC%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%882020-12-17%EF%BC%89%E6%9C%AC%E7%89%88%E6%9C%AC%E6%9F%A5%E8%AF%A2%E6%80%A7%E8%83%BD%E4%B8%8A%E5%81%9A%E4%BA%86%E5%BE%88%E5%A4%A7%E4%B8%8E%E4%BC%98%E5%8C%96\">升级到3.3版本注意事项（2020-12-17）本版本查询性能上做了很大与优化 <a class=\"header-anchor\" href=\"#%E5%8D%87%E7%BA%A7%E5%88%B03.3%E7%89%88%E6%9C%AC%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%882020-12-17%EF%BC%89%E6%9C%AC%E7%89%88%E6%9C%AC%E6%9F%A5%E8%AF%A2%E6%80%A7%E8%83%BD%E4%B8%8A%E5%81%9A%E4%BA%86%E5%BE%88%E5%A4%A7%E4%B8%8E%E4%BC%98%E5%8C%96\">#</a></h4>\n<ul>\n<li>\n<p>client没有变化可以不用升级</p>\n</li>\n<li>\n<p>版本内容</p>\n<ol>\n<li>\n<p>拆分redis队列和redis管理，支持不同的项目不同的队列</p>\n</li>\n<li>\n<p>报警支持类名模糊匹配</p>\n</li>\n<li>\n<p>报警信息输出部分详细日志</p>\n</li>\n<li>\n<p>开放了API接口方便非java项目，或者其他组件日志输入</p>\n</li>\n<li>\n<p>支持按小时分片日志，大大增加了性能，使得在机械硬盘上也能够跑出不错的效果</p>\n</li>\n<li>\n<p>其他内部优化</p>\n</li>\n</ol>\n</li>\n<li>\n<p>server配置进行了变化，增加了配置，原来的配置不变</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>增加配置</th>\n<th>用途</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>plumelog.queue.redis.redisHost</td>\n<td>队列redis独立开来，好处不同的项目可以用不通的redis当队列，提高性能</td>\n</tr>\n<tr>\n<td>plumelog.es.shards</td>\n<td>单个日志分片数，如果每个索引日志大小超过20个G这边要配置大小，默认5个</td>\n</tr>\n<tr>\n<td>plumelog.es.replicas</td>\n<td>副本数，日志大了要提升检索效率可以增加副本数，一般机械硬盘下面可以设置1，SSD设置0，设置副本增大成倍硬盘开销</td>\n</tr>\n<tr>\n<td>plumelog.es.refresh.interval</td>\n<td>日志缓冲区时间，默认30秒</td>\n</tr>\n<tr>\n<td>plumelog.es.indexType.model</td>\n<td>按天，还是按小时划分日志索引，单天超过200G，可以设置按小时，设置按小时要注意设置ES总分片数</td>\n</tr>\n<tr>\n<td>admin.log.trace.keepDays</td>\n<td>链路日志可以单独设置过期时间</td>\n</tr>\n<tr>\n<td>login.username</td>\n<td>登录用户名</td>\n</tr>\n<tr>\n<td>login.password</td>\n<td>登录密码</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>\n<p>推荐配置</p>\n<h4 id=\"%E6%8F%90%E5%8D%87%E6%80%A7%E8%83%BD%E6%8E%A8%E8%8D%90%E5%8F%82%E8%80%83%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95\">提升性能推荐参考配置方法 <a class=\"header-anchor\" href=\"#%E6%8F%90%E5%8D%87%E6%80%A7%E8%83%BD%E6%8E%A8%E8%8D%90%E5%8F%82%E8%80%83%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95\">#</a></h4>\n<h4 id=\"%E5%8D%95%E6%97%A5%E6%97%A5%E5%BF%97%E4%BD%93%E9%87%8F%E5%9C%A850g%E4%BB%A5%E5%86%85%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E7%9A%84ssd%E7%A1%AC%E7%9B%98\">单日日志体量在50G以内，并使用的SSD硬盘 <a class=\"header-anchor\" href=\"#%E5%8D%95%E6%97%A5%E6%97%A5%E5%BF%97%E4%BD%93%E9%87%8F%E5%9C%A850g%E4%BB%A5%E5%86%85%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E7%9A%84ssd%E7%A1%AC%E7%9B%98\">#</a></h4>\n<pre><code>plumelog.es.shards=5\n\nplumelog.es.replicas=0\n\nplumelog.es.refresh.interval=30s\n\nplumelog.es.indexType.model=day\n</code></pre>\n<h4 id=\"%E5%8D%95%E6%97%A5%E6%97%A5%E5%BF%97%E4%BD%93%E9%87%8F%E5%9C%A850g%E4%BB%A5%E4%B8%8A%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98\">单日日志体量在50G以上，并使用的机械硬盘 <a class=\"header-anchor\" href=\"#%E5%8D%95%E6%97%A5%E6%97%A5%E5%BF%97%E4%BD%93%E9%87%8F%E5%9C%A850g%E4%BB%A5%E4%B8%8A%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98\">#</a></h4>\n<pre><code>plumelog.es.shards=5\n\nplumelog.es.replicas=0\n\nplumelog.es.refresh.interval=30s\n\nplumelog.es.indexType.model=hour\n</code></pre>\n<h4 id=\"%E5%8D%95%E6%97%A5%E6%97%A5%E5%BF%97%E4%BD%93%E9%87%8F%E5%9C%A8100g%E4%BB%A5%E4%B8%8A%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98\">单日日志体量在100G以上，并使用的机械硬盘 <a class=\"header-anchor\" href=\"#%E5%8D%95%E6%97%A5%E6%97%A5%E5%BF%97%E4%BD%93%E9%87%8F%E5%9C%A8100g%E4%BB%A5%E4%B8%8A%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98\">#</a></h4>\n<pre><code>plumelog.es.shards=10\n\nplumelog.es.replicas=0\n\nplumelog.es.refresh.interval=30s\n\nplumelog.es.indexType.model=hour\n</code></pre>\n<h4 id=\"%E5%8D%95%E6%97%A5%E6%97%A5%E5%BF%97%E4%BD%93%E9%87%8F%E5%9C%A81000g%E4%BB%A5%E4%B8%8A%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E7%9A%84ssd%E7%A1%AC%E7%9B%98%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E5%8F%AF%E4%BB%A5%E8%B7%91%E5%88%B010t%E4%B8%80%E5%A4%A9%E4%BB%A5%E4%B8%8A%E9%83%BD%E6%B2%A1%E9%97%AE%E9%A2%98\">单日日志体量在1000G以上，并使用的SSD硬盘，这个配置可以跑到10T一天以上都没问题 <a class=\"header-anchor\" href=\"#%E5%8D%95%E6%97%A5%E6%97%A5%E5%BF%97%E4%BD%93%E9%87%8F%E5%9C%A81000g%E4%BB%A5%E4%B8%8A%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E7%9A%84ssd%E7%A1%AC%E7%9B%98%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E5%8F%AF%E4%BB%A5%E8%B7%91%E5%88%B010t%E4%B8%80%E5%A4%A9%E4%BB%A5%E4%B8%8A%E9%83%BD%E6%B2%A1%E9%97%AE%E9%A2%98\">#</a></h4>\n<pre><code>plumelog.es.shards=10\n\nplumelog.es.replicas=1\n\nplumelog.es.refresh.interval=30s\n\nplumelog.es.indexType.model=hour\n</code></pre>\n<h4 id=\"plumelog.es.shards%E7%9A%84%E5%A2%9E%E5%8A%A0%E5%92%8Chour%E6%A8%A1%E5%BC%8F%E4%B8%8B%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4es%E9%9B%86%E7%BE%A4%E7%9A%84%E6%9C%80%E5%A4%A7%E5%88%86%E7%89%87%E6%95%B0\">plumelog.es.shards的增加和hour模式下需要调整ES集群的最大分片数 <a class=\"header-anchor\" href=\"#plumelog.es.shards%E7%9A%84%E5%A2%9E%E5%8A%A0%E5%92%8Chour%E6%A8%A1%E5%BC%8F%E4%B8%8B%E9%9C%80%E8%A6%81%E8%B0%83%E6%95%B4es%E9%9B%86%E7%BE%A4%E7%9A%84%E6%9C%80%E5%A4%A7%E5%88%86%E7%89%87%E6%95%B0\">#</a></h4>\n<pre><code> PUT /_cluster/settings\n {\n   &quot;persistent&quot;: {\n     &quot;cluster&quot;: {\n       &quot;max_shards_per_node&quot;:100000\n     }\n   }\n }\n</code></pre>\n</li>\n</ul>\n<h3 id=\"3.4%E7%89%88%E6%9C%AC\">3.4版本 <a class=\"header-anchor\" href=\"#3.4%E7%89%88%E6%9C%AC\">#</a></h3>\n<h4 id=\"%E5%8D%87%E7%BA%A7%E5%88%B03.4%E7%89%88%E6%9C%AC%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%882021-02-4%EF%BC%89%E6%9C%AC%E7%89%88%E6%9C%AC%E6%8F%90%E4%BE%9B%E4%BA%86%E6%97%A5%E5%BF%97%E5%8E%8B%E7%BC%A9%E5%8A%9F%E8%83%BD\">升级到3.4版本注意事项（2021-02-4）本版本提供了日志压缩功能 <a class=\"header-anchor\" href=\"#%E5%8D%87%E7%BA%A7%E5%88%B03.4%E7%89%88%E6%9C%AC%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%882021-02-4%EF%BC%89%E6%9C%AC%E7%89%88%E6%9C%AC%E6%8F%90%E4%BE%9B%E4%BA%86%E6%97%A5%E5%BF%97%E5%8E%8B%E7%BC%A9%E5%8A%9F%E8%83%BD\">#</a></h4>\n<ul>\n<li>\n<p>client</p>\n<ol>\n<li>\n<p>kafka提供了'compressionType'字段配置kafka的压缩模式</p>\n</li>\n<li>\n<p>redis提供了'compressor'字段配置来开启日志压缩功能，开启后会使用新的队列</p>\n</li>\n</ol>\n</li>\n<li>\n<p>server</p>\n<ol>\n<li>\n<p>提供消费压缩队列的配置：plumelog.redis.compressor</p>\n</li>\n<li>\n<p>开启消费压缩队列后server端讲不再消费非压缩队列，版本升级时记得消费完相应队列数据</p>\n</li>\n</ol>\n</li>\n<li>\n<p>版本内容</p>\n<ol>\n<li>支持日志压缩</li>\n</ol>\n</li>\n<li>\n<p>实测压缩率，使用demo接口</p>\n</li>\n</ul>\n<p><img src=\"/pic/compress.png\" alt=\"实测压缩率\"></p>\n<h3 id=\"3.4.2%E7%89%88%E6%9C%AC\">3.4.2版本 <a class=\"header-anchor\" href=\"#3.4.2%E7%89%88%E6%9C%AC\">#</a></h3>\n<ul>\n<li>client 增加了环境配置字段env</li>\n<li>server 增加了环境配置字段env,ui增加了控制台风格的显示模式,优化内存管理</li>\n</ul>\n<h3 id=\"3.5%E7%89%88%E6%9C%AC\">3.5版本 <a class=\"header-anchor\" href=\"#3.5%E7%89%88%E6%9C%AC\">#</a></h3>\n<ul>\n<li>增加lite启动模式，此时不需要配置redis和es，lite模式下，扩展字段，错误统计，错误报警都不能使用，适合小规模项目使用</li>\n<li>增加了plumelog-lite模块，plumelog-lite作为plumelog依赖包的形式存在，直接引用直接使用，无需部署，嵌入到项目中</li>\n<li>增加日志控制台，查看实时输出情况，在部署和测试时候堪称神器，打开控制台的时候会影响性能，注意使用时机</li>\n<li>修复了链路追踪，有可能最外层不能显示的bug</li>\n<li>增加自动检测ES版本，不需要再配置</li>\n<li>增加自动配置ES最大分片数量，不需要去手动设置</li>\n<li>优化了界面，优化报警界面出界保存按钮显示一半的bug</li>\n<li>优化redis模式下配置，如果所有应用只用一个队列redis，管理用redis可以不用配置，会自动启用队列的redis作为管理redis</li>\n<li>修复已经已知的bug,其他优化</li>\n<li>老用户升级直接替换plumelog-server-3.5.jar，重启即可，application.properties配置文件需要加上：spring.boot.admin.context-path=admin，不然访问页面空白</li>\n<li>lite模式，需要升级客户端到3.5</li>\n<li>内嵌springboot-admin，方便管理springboot项目，可以利用springbootadmin,动态调整日志输出级别，</li>\n</ul>\n",
  "link": "/zh-cn/docs/update.html",
  "meta": {}
}